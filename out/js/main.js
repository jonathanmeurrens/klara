!function(a,b){function c(a){FB.ui({method:"stream.publish",display:"popup",message:"",name:"Klara",caption:"WIN ook een reis met klara.be",description:"Ik reisde "+a+"km met klara.be. Reis ook de wereld rond en WIN!",link:"http://klara.be",picture:"http://images.uncyc.org/nl/a/a6/Logo_Klara.jpg"},function(a){a&&a.post_id?console.log("Post was published"):console.log("Post NOT published")})}b["true"]=a;var d=function(){function a(c){b=this,this.view=new createjs.Container;var d="assets/buttons/"+c.toLowerCase()+".png";this.width=50,this.height=50,(c===a.FACEBOOK||c===a.TWITTER)&&(this.width=23,this.height=23),this.view.regX=this.width/2,this.view.regY=this.height/2,this.btn=new createjs.Bitmap(z.getResult(d)),this.view.addChild(this.btn),this.btn.regX=this.width/2,this.btn.regY=this.height/2,this.btn.addEventListener("mouseover",function(a){createjs.Tween.get(a.target).to({scaleX:1.07,scaleY:1.07},100)}),this.btn.addEventListener("mouseout",function(a){createjs.Tween.get(a.target).to({scaleX:1,scaleY:1},100)}),this.view.cursor="pointer",this.btn.scaleX=.7,this.btn.scaleY=.7,createjs.Tween.get(this.btn).to({scaleX:1,scaleY:1},1400,createjs.Ease.elasticOut)}var b;return a}();d.FACEBOOK="FACEBOOK",d.TWITTER="TWITTER";var e=function(){function a(){c=this,this.view=new createjs.Container,setTimeout(b,300)}function b(){c.slideshow=new n,c.view.addChild(c.slideshow.view)}var c;return a.prototype.willBeRemoved=function(){c.view.removeChild(c.slideshow),c.slideshow=null},a}(),f=function(){function a(){b=this,this.view=new createjs.Container,this.background=new createjs.Shape,this.background.graphics.beginFill("#ffd600"),this.background.graphics.drawRect(0,0,0,20),this.background.graphics.endFill(),this.view.addChild(this.background),this.programmaTitleTxt=new createjs.Text("","10px orator_stdregular","#000000"),this.programmaTitleTxt.textAlign="right",this.view.addChild(this.programmaTitleTxt),this.programmaDescTxt=new createjs.Text("","12px orator_stdregular","#000000"),this.programmaDescTxt.y=20,this.programmaDescTxt.textAlign="right",this.programmaDescTxt.lineWidth=300,this.programmaDescTxt.textBaseline="top",this.programmaDescTxt.lineHeight=14,this.view.addChild(this.programmaDescTxt),this.programmaPresentatorTxt=new createjs.Text("","12px orator_stdregular","#000000"),this.programmaPresentatorTxt.y=0,this.programmaPresentatorTxt.textAlign="right",this.view.y=-50,bean.on(x,u.NOW_AND_NEXT_LOADED,function(){console.log("[CurrentProgramma] now and next loaded, is nextSong? =>",x.nextSong),b.view.alpha=null==x.nextSong?1:0,console.log("[CurrentProgramma] now and next loaded: "+x.nextSong)}),bean.on(x,u.CURRENT_PROGRAMMA_CHANGED,function(){console.log("[CurrentProgramma] programma changed: "+x.currentProgramma),b.programmaTitleTxt.text=x.currentProgramma.title.toUpperCase(),b.background.graphics.clear(),b.background.graphics.beginFill("#ffd600"),b.background.graphics.drawRect(-b.programmaTitleTxt.getMeasuredWidth()-11,-2,b.programmaTitleTxt.getMeasuredWidth()+14,18),b.background.graphics.endFill();var a=x.currentProgramma.description;b.programmaDescTxt.text=a,b.view.alpha=x.userModel.songs.length-1===x.currentSongIndex?1:0})}var b;return a}(),g=function(){function a(b){a.CLICKED="CLICKED",this.songIndex=b,this.view=new createjs.Container,this.view.x=y.canvas.width/2,this.view.y=y.canvas.height/2,this.bullet=new createjs.Container,this.view.addChild(this.bullet);var c=new createjs.Shape;c.graphics.beginFill("#000000").drawCircle(0,0,5),c.alpha=.01,this.bullet.addChild(c),this.circle=new createjs.Shape,this.circle.graphics.beginFill("#000000").drawCircle(0,0,1.5),this.bullet.addChild(this.circle),this.bullet.mouseEnabled=!0,this.bullet.addEventListener("click",$.proxy(function(){x.setCurrentSongIndex(this.songIndex)},this)),this.bullet.addEventListener("mouseover",$.proxy(function(){createjs.Tween.get(this.circle).to({scaleX:2,scaleY:2},100)},this)),this.bullet.addEventListener("mouseout",$.proxy(function(){createjs.Tween.get(this.circle).to({scaleX:1,scaleY:1},100)},this))}return a.prototype.randomPosition=function(){this.view.alpha=0;var a=y.canvas.width/2-150*(x.userModel.songs.length-(this.songIndex+1)),b=y.canvas.height/2,c=3e3+3e3*Math.random();this.bullet.scaleX=this.bullet.scaleY=1,createjs.Tween.get(this.view).to({x:a,y:b,alpha:1},c,createjs.Ease.elasticOut)},a.prototype.centerPosition=function(){var a=y.canvas.width/2,b=y.canvas.height/2,c=3e3+3e3*Math.random();this.view.alpha=0,createjs.Tween.get(this.view).to({x:a,y:b,alpha:1},c,createjs.Ease.elasticOut),this.bullet.scaleX=this.bullet.scaleY=2.5},a.prototype.showInfoView=function(){null==this.dotInfo&&(this.dotInfo=new h(x.userModel.songs[this.songIndex]),this.view.addChild(this.dotInfo.view),this.bullet.scaleX=this.bullet.scaleY=2.5)},a.prototype.hideInfoView=function(){null!=this.dotInfo&&(this.view.removeChild(this.dotInfo.view),this.dotInfo=null,this.bullet.scaleX=this.bullet.scaleY=1)},a}(),h=function(){function a(a){this.view=new createjs.Container,this.shadowShape=new createjs.Shape,this.shadowShape.graphics.beginFill("#000000"),this.shadowShape.graphics.lineTo(0,0),this.shadowShape.graphics.lineTo(60,-75),this.shadowShape.graphics.lineTo(170,-75),this.shadowShape.graphics.lineTo(170,-30),this.shadowShape.graphics.endFill(),this.shadowShape.graphics.closePath(),this.shadowShape.alpha=.07,this.view.addChild(this.shadowShape),this.backgroundShape=new createjs.Shape,this.backgroundShape.graphics.beginFill("#000"),this.backgroundShape.graphics.lineTo(0,0),this.backgroundShape.graphics.lineTo(30,-100),this.backgroundShape.graphics.lineTo(150,-100),this.backgroundShape.graphics.lineTo(150,-40),this.backgroundShape.graphics.endFill(),this.backgroundShape.graphics.closePath(),this.view.addChild(this.backgroundShape),this.titleTxt=new createjs.Text(a.title.toUpperCase(),"18px proxima_nova_extra_condenseLt","#f5f5f5"),this.titleTxt.y=-94,this.titleTxt.mask=this.backgroundShape,this.view.addChild(this.titleTxt),this.titleTxt2=new createjs.Text(a.title.toUpperCase(),"18px proxima_nova_extra_condenseLt","#f5f5f5"),this.titleTxt2.y=-94,this.titleTxt2.mask=this.backgroundShape,this.view.addChild(this.titleTxt2),this.titleTxt.x=55,this.titleTxt2.x=this.titleTxt.x+this.titleTxt.getMeasuredWidth(),this.artistTxt=new createjs.Text(a.artist.toUpperCase(),"12px orator_stdregular","#D5C502"),this.artistTxt.y=-70,this.artistTxt.x=28,this.artistTxt.mask=this.backgroundShape,this.artistTxt.text.length>15&&(this.artistTxt.text=this.artistTxt.text.substring(0,15)+"..."),this.view.addChild(this.artistTxt),$(this.view).on("tick",$.proxy(b,this))}function b(){this.titleTxt.x-=.6,this.titleTxt2.x-=.6,this.titleTxt.x<-this.titleTxt.getMeasuredWidth()&&(this.titleTxt.x=this.titleTxt2.x+this.titleTxt2.getMeasuredWidth()+40),this.titleTxt2.x<-this.titleTxt2.getMeasuredWidth()&&(this.titleTxt2.x=this.titleTxt.x+this.titleTxt.getMeasuredWidth()+40)}return a}(),i=(function(){function a(a,b,c){this.view=new createjs.Container;var d=new createjs.Text(c,"12px Arial","#000000"),e=new createjs.Shape;this.view.addChild(e),this.view.addChild(d),this.view.x=a,this.view.y=b}return a}(),function(){function a(){f=this,this.dots=[],this.view=new createjs.Container,this.mapWidth=12e3,this.mapHeight=12e3,this.mapBg=new createjs.Bitmap(z.getResult("worldmap")),this.view.addChild(this.mapBg),this.lines=new createjs.Graphics;var a=new createjs.Shape(this.lines);this.view.addChild(a),this.plane=new createjs.Bitmap("assets/plane.png"),this.plane.regX=this.plane.regY=9,this.view.addChild(this.plane),this.isAnimatingToCenter=!1,bean.on(x,u.NOW_AND_NEXT_LOADED,function(){console.log("[MyMap] loading done"),f.draw(),b(x.currentSongIndex);var a=f.dots[x.currentSongIndex].view.x,c=f.dots[x.currentSongIndex].view.y;if(f.plane.x=a,f.plane.y=c,f.dots.length>=x.currentSongIndex+2){createjs.Tween.removeTweens(f.plane);var d=f.dots[x.currentSongIndex+1].view.x,g=f.dots[x.currentSongIndex+1].view.y;f.plane.rotation=e(a,c,d,g)-180,x.setFlightAngle(e(a,c,d,g)-180),createjs.Tween.get(f.plane).to({x:d,y:g},1e3*x.userModel.songs[x.currentSongIndex].duration)}}),bean.on(x,u.CURRENT_SONG_CHANGED,function(){b(x.currentSongIndex)}),this.view.addEventListener("mousedown",function(a){var b=f.view;f.view.offset={x:b.x-a.stageX,y:b.y-a.stageY}}),this.view.on("pressmove",function(a){var b=f.view;b.x=a.stageX+b.offset.x,b.y=a.stageY+b.offset.y,y.update()}),$(this.view).on("tick",$.proxy(c,this))}function b(a){if(console.log("[MyMap] center map: "+a),!f.isAnimatingToCenter&&(f.isAnimatingToCenter=!0,f.dots.length>0))if(0>a){console.log("[MyMap] zoom out on map");var b=d(50.5333,4.7667);console.log(b);var c=Math.round(-b.x+y.canvas.width/2),e=Math.round(-b.y+y.canvas.height/2);createjs.Tween.get(f.view).to({x:c,y:e},2e3,createjs.Ease.cubicInOut).call(function(){f.isAnimatingToCenter=!1})}else{for(var g=0;g<f.dots.length;g++)f.dots[g].hideInfoView();f.dots[a].showInfoView();var h=Math.round(-f.dots[a].view.x+y.canvas.width/2),i=Math.round(-f.dots[a].view.y+y.canvas.height/2);createjs.Tween.get(f.view).to({x:h,y:i},2e3,createjs.Ease.cubicInOut).call(function(){f.isAnimatingToCenter=!1})}}function c(){this.lines.clear(),this.lines.setStrokeStyle(.3),this.lines.beginStroke(createjs.Graphics.getRGB(180,180,180));for(var a=0;a<this.dots.length-1;a++)this.lines.moveTo(this.dots[a].view.x,this.dots[a].view.y),this.lines.lineTo(this.dots[a+1].view.x,this.dots[a+1].view.y)}function d(a,b){var c=Math.round((b+180)*(f.mapWidth/360)),d=a*Math.PI/180,e=Math.log(Math.tan(Math.PI/4+d/2)),g=Math.round(f.mapHeight/2-f.mapWidth*e/(2*Math.PI));return{x:c,y:g}}function e(a,b,c,d){var e=d-b,f=c-a,g=180*Math.atan2(e,f)/Math.PI;return g}var f;return a.prototype.draw=function(){var a=this.dots.length;0>a&&(a=0);for(var b=a;b<x.userModel.songs.length;b++){var c=new g(b);this.view.addChild(c.view),this.dots.push(c);var e=d(x.userModel.songs[b].lat,x.userModel.songs[b].lng);c.view.x=e.x,c.view.y=e.y}},a}()),j=(function(){function a(){this.view=new createjs.Container,this.shape=new createjs.Shape,this.shape.graphics.setStrokeStyle(2),this.shape.graphics.beginStroke("#000000"),this.shape.graphics.drawCircle(0,0,10),this.shape.graphics.endStroke(),this.view.addChild(this.shape),$(this.view).on("tick",$.proxy(b,this))}function b(){this.shape.scaleX=this.shape.scaleY+=.01,this.shape.alpha-=.03,this.shape.scaleX>=3&&(this.shape.scaleX=this.shape.scaleY=0,this.shape.alpha=1)}return a}(),function(){function a(){b=this,this.view=new createjs.Container,this.player=document.getElementById("player");var a={images:["assets/buttons/play_pause.png"],frames:{width:28.5,height:37},animations:{on:[0],mute:[1]}},c=new createjs.SpriteSheet(a);this.muteBtnSprite=new createjs.Sprite(c),this.view.addChild(this.muteBtnSprite),this.muteBtnSprite.addEventListener("click",function(){b.player.paused?(b.player.play(),b.muteBtnSprite.gotoAndStop("on")):(b.player.pause(),b.muteBtnSprite.gotoAndStop("mute")),x.setIsPlaying(!b.player.paused)})}var b;return a}(),function(){function a(a,e){j=this,bean.on(x.userModel,w.PROGRESS_CHANGED,g),bean.on(x,u.PLAYER_STATUS_CHANGED,h),bean.on(x,u.FLIGHT_ANGLE_CHANGED,b),this.view=new createjs.Container,this.view.regX=this.view.regY=-32,this.view.x=a,this.view.y=e;var k=y.canvas.width+64;this.cloud=new createjs.Bitmap(z.getResult("cloud")),this.cloud.regX=243,this.cloud.regY=124.5,this.view.addChild(this.cloud),this.shapeBg=new createjs.Shape,this.shapeBg.graphics.beginFill("#ec008c"),this.shapeBg.graphics.drawCircle(0,0,k),this.shapeBg.graphics.endFill(),this.view.addChild(this.shapeBg),this.shapeBg.scaleX=this.shapeBg.scaleY=0,this.app_title=new createjs.Bitmap(z.getResult("app_title")),this.app_title.regX=-60,this.app_title.regY=33,this.app_title.alpha=0,this.view.addChild(this.app_title),createjs.Tween.get(this.app_title).to({alpha:1},1e3),this.borderCircle=new createjs.Shape,this.borderCircle.mouseEnabled=!0,this.borderCircle.graphics.setStrokeStyle(.3),this.borderCircle.graphics.beginStroke(createjs.Graphics.getRGB(180,180,180)),this.borderCircle.graphics.drawCircle(0,0,70),this.view.addChild(this.borderCircle),this.borderCircle.scaleX=this.borderCircle.scaleY=0,this.logo_bg=new createjs.Bitmap(z.getResult("logo_background")),this.logo_bg.regX=47,this.logo_bg.regY=47,this.logo_bg.alpha=0,this.view.addChild(this.logo_bg),createjs.Tween.get(this.logo_bg).to({alpha:1},1e3),this.compassOuter=new createjs.Bitmap(z.getResult("compass-outer")),this.compassOuter.regX=76,this.compassOuter.regY=76,this.compassOuter.alpha=0,this.view.addChild(this.compassOuter),createjs.Tween.get(this.compassOuter).to({alpha:1},1e3),this.compassInner=new createjs.Bitmap(z.getResult("compass-inner")),this.compassInner.regX=59,this.compassInner.regY=59,this.compassInner.alpha=0,this.view.addChild(this.compassInner),createjs.Tween.get(this.compassInner).to({alpha:1},1e3),this.indicator=new createjs.Bitmap(z.getResult("compass-indicator")),this.indicator.regX=-55,this.indicator.regY=2,this.indicator.alpha=0,this.view.addChild(this.indicator),createjs.Tween.get(this.indicator).to({alpha:1},1e3),this.logo=new createjs.Bitmap(z.getResult("klara_logo")),this.logo.regX=26,this.logo.regY=28,this.logo.alpha=0,this.view.addChild(this.logo),createjs.Tween.get(this.logo).to({alpha:1},1e3),this.progressTxt=new createjs.Text("","12px orator_stdregular","#222222"),this.progressTxt.y=-7,this.progressTxt.x=273,this.progressTxt.textAlign="right",this.view.addChild(this.progressTxt),this.isOpen=!1,this.view.mouseEnabled=!0,this.logo.addEventListener("click",$.proxy(f,this)),this.progressTimer=setInterval(function(){x.userModel.setProgress(x.userModel.progress+=1),x.userModel.progress===w.LISTENING_TARGET&&console.log("[UserModel] show form")},1e3);var l=new d(d.FACEBOOK);this.view.addChild(l.view),l.view.x=305,l.view.y=-11,l.view.addEventListener("click",function(){c(x.userModel.progress)});var m=new d(d.TWITTER);this.view.addChild(m.view),m.view.x=l.view.x+30,m.view.y=-11,m.view.addEventListener("click",function(){var a="http://twitter.com/home?status= Ik reisde al "+x.userModel.progress+"km met Klara. Reis ook mee en WIN een reis!";window.open(a,"_blank")}),$(this.view).on("tick",$.proxy(i,this))}function b(){createjs.Tween.removeTweens(j.indicator),e(x.flightAngle)}function e(){var a=x.flightAngle-180;createjs.Tween.get(j.indicator).to({rotation:15+a-15*Math.random()},1e3+Math.random(),createjs.Tween.cubicInOut).call(e)}function f(){this.isOpen?(createjs.Tween.get(this.shapeBg).to({scaleX:0,scaleY:0},500,createjs.Ease.easeOut),t.removeCurrentScreen()):(createjs.Tween.get(this.shapeBg).to({scaleX:1,scaleY:1},500),t.showScreen(t.CAMPAIGN_INFO)),this.isOpen=!this.isOpen}function g(){j.progressTxt.text=x.userModel.progress+"/"+w.LISTENING_TARGET+"KM"}function h(){x.isPlaying?j.progressTimer=setInterval(function(){x.userModel.setProgress(x.userModel.progress+=1)},1e3):(clearTimeout(j.progressTimer),j.progressTimer=null)}function i(){null!=this.plane&&(this.plane.rotation-=.5)}var j;return a}()),k=function(){function a(){c=this,this.view=new createjs.Container,this.line=new createjs.Graphics;var a=new createjs.Shape(this.line);this.view.addChild(a),this.line.clear(),this.circleS=new createjs.Shape,this.circleS.graphics.beginFill("black").drawCircle(0,0,2),this.circleS.x=Math.floor(window.innerWidth/2-101),this.circleS.y=Math.floor(window.innerHeight/2+147),this.circleS.alpha=0,this.view.addChild(this.circleS),this.circleE=new createjs.Shape,this.circleE.graphics.beginFill("black").drawCircle(0,0,2),this.circleE.x=Math.floor(window.innerWidth/2-100),this.circleE.y=Math.floor(window.innerHeight/2+146),this.view.addChild(this.circleE),this.logo=new createjs.Bitmap(z.getResult("logo")),this.logo.width=239,this.logo.height=249,this.logo.x=window.innerWidth/2-this.logo.width/2,this.logo.y=window.innerHeight/2-this.logo.height/2,this.view.addChild(this.logo),this.airport=new createjs.Bitmap(z.getResult("airport")),this.airport.x=Math.floor(window.innerWidth/2+156+17),this.airport.y=Math.floor(window.innerHeight/2-56+17),this.airport.scaleX=this.airport.scaleY=0,this.airport.regX=this.airport.regY=17,this.view.addChild(this.airport),this.label=new createjs.Bitmap(z.getResult("athene_label")),this.label.x=Math.floor(window.innerWidth/2+174),this.label.y=Math.floor(window.innerHeight/2-71+29),this.label.regY=29,this.label.rotation=15,this.label.alpha=0,this.view.addChild(this.label),this.image=new createjs.Bitmap(z.getResult("athene_image")),this.image.x=Math.floor(window.innerWidth/2+50),this.image.y=Math.floor(window.innerHeight/2-124),this.image.alpha=0,this.view.addChild(this.image),this.plane=new createjs.Bitmap(z.getResult("plane")),this.plane.x=Math.floor(window.innerWidth/2-50),this.plane.y=Math.floor(window.innerHeight/2-84),this.plane.alpha=0,this.view.addChild(this.plane),this.map=new createjs.Bitmap(z.getResult("athene_map")),this.map.x=Math.floor(window.innerWidth/2-210),this.map.y=Math.floor(window.innerHeight/2-86),this.map.alpha=0,this.view.addChild(this.map),this.twitter=new createjs.Bitmap(z.getResult("twitter")),this.twitter.x=Math.floor(window.innerWidth/2-93+11),this.twitter.y=Math.floor(window.innerHeight/2+141+11),this.twitter.scaleX=this.twitter.scaleY=.5,this.twitter.regX=this.twitter.regY=11,this.twitter.alpha=0,this.view.addChild(this.twitter),this.facebook=new createjs.Bitmap(z.getResult("facebook")),this.facebook.x=Math.floor(window.innerWidth/2-111+11),this.facebook.y=Math.floor(window.innerHeight/2+118+11),this.facebook.scaleX=this.facebook.scaleY=.5,this.facebook.regX=this.facebook.regY=11,this.facebook.alpha=0,this.view.addChild(this.facebook),this.tip=new createjs.Bitmap(z.getResult("tip")),this.tip.width=279,this.tip.height=54,this.tip.x=Math.floor(window.innerWidth/2+150),this.tip.y=Math.floor(window.innerHeight/2-this.tip.height/2+5),this.tip.alpha=0,this.view.addChild(this.tip)}function b(){this.line&&this.line.clear(),this.line.setStrokeStyle(.8),this.line.beginStroke("black"),this.line.moveTo(window.innerWidth/2-101,window.innerHeight/2+147),this.line.lineTo(this.circleE.x,this.circleE.y),this.circleE.x===this.circleS.x&&this.line.clear()}var c;return a.prototype.animateIn=function(){$(this.view).on("tick",$.proxy(b,this)),createjs.Tween.get(this.facebook).wait(800).to({scaleX:1,scaleY:1,alpha:1},600,createjs.Ease.elasticOut),createjs.Tween.get(this.twitter).wait(1e3).to({scaleX:1,scaleY:1,alpha:1},600,createjs.Ease.elasticOut),createjs.Tween.get(this.map).to({alpha:1},2e3,createjs.Ease.cubicOut),createjs.Tween.get(this.tip).to({x:Math.floor(window.innerWidth/2-this.tip.width/2),alpha:1},3e3,createjs.Ease.cubicOut),createjs.Tween.get(this.image).to({x:Math.floor(window.innerWidth/2-119),alpha:1},3e3,createjs.Ease.cubicOut),createjs.Tween.get(this.plane).to({x:Math.floor(window.innerWidth/2+155),alpha:1},3e3,createjs.Ease.cubicOut).call(function(){c.animateOut()}),createjs.Tween.get(this.circleE).to({x:Math.floor(window.innerWidth/2+174),y:Math.floor(window.innerHeight/2-39)},1e3,createjs.Ease.cubicOut),createjs.Tween.get(this.airport).wait(1e3).to({scaleX:1,scaleY:1},1e3,createjs.Ease.elasticOut),createjs.Tween.get(this.label).wait(1500).to({rotation:0,alpha:1},1e3,createjs.Ease.elasticOut)},a.prototype.animateOut=function(){createjs.Tween.get(this.facebook).wait(800).to({scaleX:.5,scaleY:.5,alpha:0},200,createjs.Ease.cubicIn),createjs.Tween.get(this.twitter).wait(1e3).to({scaleX:.5,scaleY:.5,alpha:0},300,createjs.Ease.cubicIn),createjs.Tween.get(this.map).wait(1e3).to({alpha:0},2e3,createjs.Ease.cubicOut),createjs.Tween.get(this.tip).to({x:Math.floor(window.innerWidth/2-this.tip.width/2-150),alpha:0},2e3,createjs.Ease.cubicIn),createjs.Tween.get(this.image).to({x:Math.floor(window.innerWidth/2-200),alpha:0},2e3,createjs.Ease.cubicIn),createjs.Tween.get(this.plane).to({x:Math.floor(window.innerWidth/2+350),alpha:0},2e3,createjs.Ease.cubicIn).call(function(){c.view.removeAllChildren(),bean.fire(c,n.NEXT_SLIDE)}),createjs.Tween.get(this.circleE).wait(1050).to({x:Math.floor(window.innerWidth/2-101),y:Math.floor(window.innerHeight/2+147),alpha:0},500,createjs.Ease.cubicIn),createjs.Tween.get(this.airport).wait(450).to({scaleX:0,scaleY:0},600,createjs.Ease.elasticIn),createjs.Tween.get(this.label).wait(200).to({rotation:20,alpha:0},250,createjs.Ease.cubicIn)},a}(),l=function(){function a(){c=this,this.view=new createjs.Container,this.line=new createjs.Graphics;var a=new createjs.Shape(this.line);this.view.addChild(a),this.circleS=new createjs.Shape,this.circleS.graphics.beginFill("black").drawCircle(0,0,2),this.circleS.x=Math.floor(window.innerWidth/2+185),this.circleS.y=Math.floor(window.innerHeight/2+79),this.circleS.alpha=0,this.view.addChild(this.circleS),this.circleE=new createjs.Shape,this.circleE.graphics.beginFill("black").drawCircle(0,0,2),this.circleE.x=Math.floor(window.innerWidth/2+184),this.circleE.y=Math.floor(window.innerHeight/2+78),this.view.addChild(this.circleE),this.logo=new createjs.Bitmap(z.getResult("logo")),this.logo.width=239,this.logo.height=249,this.logo.x=window.innerWidth/2-this.logo.width/2,this.logo.y=window.innerHeight/2-this.logo.height/2,this.view.addChild(this.logo),this.airport=new createjs.Bitmap(z.getResult("airport")),this.airport.x=Math.floor(window.innerWidth/2-90+17),this.airport.y=Math.floor(window.innerHeight/2-178+17),this.airport.scaleX=this.airport.scaleY=0,this.airport.regX=this.airport.regY=17,this.view.addChild(this.airport),this.label=new createjs.Bitmap(z.getResult("newyork_label")),this.label.x=Math.floor(window.innerWidth/2-72),this.label.y=Math.floor(window.innerHeight/2-189+26),this.label.regY=26,this.label.rotation=15,this.label.alpha=0,this.view.addChild(this.label),this.plane=new createjs.Bitmap(z.getResult("plane")),this.plane.x=Math.floor(window.innerWidth/2-300),this.plane.y=Math.floor(window.innerHeight/2-202),this.plane.alpha=0,this.view.addChild(this.plane),this.image=new createjs.Bitmap(z.getResult("newyork_image")),this.image.width=239,this.image.height=249,this.image.x=Math.floor(window.innerWidth/2+50),this.image.y=Math.floor(window.innerHeight/2-this.image.height/2),this.image.alpha=0,this.view.addChild(this.image),this.map=new createjs.Bitmap(z.getResult("newyork_map")),this.map.x=Math.floor(window.innerWidth/2-140),this.map.y=Math.floor(window.innerHeight/2-167),this.map.alpha=0,this.view.addChild(this.map),this.twitter=new createjs.Bitmap(z.getResult("twitter")),this.twitter.x=Math.floor(window.innerWidth/2+154+11),this.twitter.y=Math.floor(window.innerHeight/2+71+11),this.twitter.scaleX=this.twitter.scaleY=.5,this.twitter.regX=this.twitter.regY=11,this.twitter.alpha=0,this.view.addChild(this.twitter),this.facebook=new createjs.Bitmap(z.getResult("facebook")),this.facebook.x=Math.floor(window.innerWidth/2+174+11),this.facebook.y=Math.floor(window.innerHeight/2+48+11),this.facebook.scaleX=this.facebook.scaleY=.5,this.facebook.regX=this.facebook.regY=11,this.facebook.alpha=0,this.view.addChild(this.facebook),this.tip=new createjs.Bitmap(z.getResult("tip")),this.tip.width=279,this.tip.height=54,this.tip.x=Math.floor(window.innerWidth/2+150),this.tip.y=Math.floor(window.innerHeight/2-this.tip.height/2+5),this.tip.alpha=0,this.view.addChild(this.tip)}function b(){this.line&&this.line.clear(),this.line.setStrokeStyle(.8),this.line.beginStroke("black"),this.line.moveTo(window.innerWidth/2+185,window.innerHeight/2+79),this.line.lineTo(this.circleE.x,this.circleE.y),this.circleE.x===this.circleS.x&&this.line.clear()}var c;return a.prototype.animateIn=function(){$(this.view).on("tick",$.proxy(b,this)),createjs.Tween.get(this.facebook).wait(800).to({scaleX:1,scaleY:1,alpha:1},600,createjs.Ease.elasticOut),createjs.Tween.get(this.twitter).wait(1e3).to({scaleX:1,scaleY:1,alpha:1},600,createjs.Ease.elasticOut),createjs.Tween.get(this.map).to({alpha:1},2e3,createjs.Ease.cubicOut),createjs.Tween.get(this.tip).to({x:Math.floor(window.innerWidth/2-this.tip.width/2),alpha:1},3e3,createjs.Ease.cubicOut),createjs.Tween.get(this.image).to({x:Math.floor(window.innerWidth/2-this.image.width/2),alpha:1},3e3,createjs.Ease.cubicOut),createjs.Tween.get(this.plane).to({x:Math.floor(window.innerWidth/2-92),alpha:1},3e3,createjs.Ease.cubicOut).call(function(){c.animateOut()}),createjs.Tween.get(this.circleE).to({x:Math.floor(window.innerWidth/2-72),y:Math.floor(window.innerHeight/2-160)},1e3,createjs.Ease.cubicOut),createjs.Tween.get(this.airport).wait(1e3).to({scaleX:1,scaleY:1},1e3,createjs.Ease.elasticOut),createjs.Tween.get(this.label).wait(1500).to({rotation:0,alpha:1},1e3,createjs.Ease.elasticOut)},a.prototype.animateOut=function(){createjs.Tween.get(this.facebook).wait(800).to({scaleX:.5,scaleY:.5,alpha:0},200,createjs.Ease.cubicIn),createjs.Tween.get(this.twitter).wait(1e3).to({scaleX:.5,scaleY:.5,alpha:0},300,createjs.Ease.cubicIn),createjs.Tween.get(this.map).wait(1e3).to({alpha:0},2e3,createjs.Ease.cubicOut),createjs.Tween.get(this.tip).to({x:Math.floor(window.innerWidth/2-this.tip.width/2-150),alpha:0},2e3,createjs.Ease.cubicIn),createjs.Tween.get(this.image).to({x:Math.floor(window.innerWidth/2-this.image.width/2-100),alpha:0},2e3,createjs.Ease.cubicIn),createjs.Tween.get(this.plane).to({x:Math.floor(window.innerWidth/2+100),alpha:0},2e3,createjs.Ease.cubicIn).call(function(){c.view.removeAllChildren(),bean.fire(c,n.NEXT_SLIDE)}),createjs.Tween.get(this.circleE).wait(1050).to({x:Math.floor(window.innerWidth/2+185),y:Math.floor(window.innerHeight/2+79),alpha:0},500,createjs.Ease.cubicIn),createjs.Tween.get(this.airport).wait(450).to({scaleX:0,scaleY:0},600,createjs.Ease.elasticIn),createjs.Tween.get(this.label).wait(200).to({rotation:20,alpha:0},250,createjs.Ease.cubicIn)},a}(),m=function(){function a(){c=this,this.view=new createjs.Container,this.line=new createjs.Graphics;var a=new createjs.Shape(this.line);this.view.addChild(a),this.line.clear(),this.circleS=new createjs.Shape,this.circleS.graphics.beginFill("black").drawCircle(0,0,2),this.circleS.x=Math.floor(window.innerWidth/2+191),this.circleS.y=Math.floor(window.innerHeight/2+120),this.circleS.alpha=0,this.view.addChild(this.circleS),this.circleE=new createjs.Shape,this.circleE.graphics.beginFill("black").drawCircle(0,0,2),this.circleE.x=Math.floor(window.innerWidth/2+190),this.circleE.y=Math.floor(window.innerHeight/2+119),this.view.addChild(this.circleE),this.logo=new createjs.Bitmap(z.getResult("logo")),this.logo.width=239,this.logo.height=249,this.logo.x=window.innerWidth/2-this.logo.width/2,this.logo.y=window.innerHeight/2-this.logo.height/2,this.view.addChild(this.logo),this.airport=new createjs.Bitmap(z.getResult("airport")),this.airport.x=Math.floor(window.innerWidth/2-209+17),this.airport.y=Math.floor(window.innerHeight/2-62+17),this.airport.scaleX=this.airport.scaleY=0,this.airport.regX=this.airport.regY=17,this.view.addChild(this.airport),this.label=new createjs.Bitmap(z.getResult("wenen_label")),this.label.x=Math.floor(window.innerWidth/2-191),this.label.y=Math.floor(window.innerHeight/2-80+32),this.label.regY=32,this.label.rotation=15,this.label.alpha=0,this.view.addChild(this.label),this.plane=new createjs.Bitmap(z.getResult("plane")),this.plane.x=Math.floor(window.innerWidth/2-400),this.plane.y=Math.floor(window.innerHeight/2-94),this.plane.alpha=0,this.view.addChild(this.plane),this.image=new createjs.Bitmap(z.getResult("wenen_image")),this.image.x=Math.floor(window.innerWidth/2+50),this.image.y=Math.floor(window.innerHeight/2-3),this.image.alpha=0,this.view.addChild(this.image),this.map=new createjs.Bitmap(z.getResult("wenen_map")),this.map.x=Math.floor(window.innerWidth/2-240),this.map.y=Math.floor(window.innerHeight/2-117),this.map.alpha=0,this.view.addChild(this.map),this.twitter=new createjs.Bitmap(z.getResult("twitter")),this.twitter.x=Math.floor(window.innerWidth/2+161+11),this.twitter.y=Math.floor(window.innerHeight/2+118+11),this.twitter.scaleX=this.twitter.scaleY=.5,this.twitter.regX=this.twitter.regY=11,this.twitter.alpha=0,this.view.addChild(this.twitter),this.facebook=new createjs.Bitmap(z.getResult("facebook")),this.facebook.x=Math.floor(window.innerWidth/2+174+11),this.facebook.y=Math.floor(window.innerHeight/2+91+11),this.facebook.scaleX=this.facebook.scaleY=.5,this.facebook.regX=this.facebook.regY=11,this.facebook.alpha=0,this.view.addChild(this.facebook),this.tip=new createjs.Bitmap(z.getResult("tip")),this.tip.width=279,this.tip.height=54,this.tip.x=Math.floor(window.innerWidth/2+150),this.tip.y=Math.floor(window.innerHeight/2-this.tip.height/2+5),this.tip.alpha=0,this.view.addChild(this.tip)}function b(){this.line&&this.line.clear(),this.line.setStrokeStyle(.8),this.line.beginStroke("black"),this.line.moveTo(window.innerWidth/2+191,window.innerHeight/2+120),this.line.lineTo(this.circleE.x,this.circleE.y),this.circleE.x===this.circleS.x&&this.line.clear()}var c;return a.prototype.animateIn=function(){$(this.view).on("tick",$.proxy(b,this)),createjs.Tween.get(this.facebook).wait(800).to({scaleX:1,scaleY:1,alpha:1},600,createjs.Ease.elasticOut),createjs.Tween.get(this.twitter).wait(1e3).to({scaleX:1,scaleY:1,alpha:1},600,createjs.Ease.elasticOut),createjs.Tween.get(this.map).to({alpha:1},2e3,createjs.Ease.cubicOut),createjs.Tween.get(this.tip).to({x:Math.floor(window.innerWidth/2-this.tip.width/2),alpha:1},3e3,createjs.Ease.cubicOut),createjs.Tween.get(this.image).to({x:Math.floor(window.innerWidth/2-9),alpha:1},3e3,createjs.Ease.cubicOut),createjs.Tween.get(this.plane).to({x:Math.floor(window.innerWidth/2-210),alpha:1},3e3,createjs.Ease.cubicOut).call(function(){c.animateOut()}),createjs.Tween.get(this.circleE).to({x:Math.floor(window.innerWidth/2-191),y:Math.floor(window.innerHeight/2-45)},1e3,createjs.Ease.cubicOut),createjs.Tween.get(this.airport).wait(1e3).to({scaleX:1,scaleY:1},1e3,createjs.Ease.elasticOut),createjs.Tween.get(this.label).wait(1500).to({rotation:0,alpha:1},1e3,createjs.Ease.elasticOut)},a.prototype.animateOut=function(){createjs.Tween.get(this.facebook).wait(800).to({scaleX:.5,scaleY:.5,alpha:0},200,createjs.Ease.cubicIn),createjs.Tween.get(this.twitter).wait(1e3).to({scaleX:.5,scaleY:.5,alpha:0},300,createjs.Ease.cubicIn),createjs.Tween.get(this.map).wait(1e3).to({alpha:0},2e3,createjs.Ease.cubicOut),createjs.Tween.get(this.tip).to({x:Math.floor(window.innerWidth/2-this.tip.width/2-150),alpha:0},2e3,createjs.Ease.cubicIn),createjs.Tween.get(this.image).to({x:Math.floor(window.innerWidth/2-100),alpha:0},2e3,createjs.Ease.cubicIn),createjs.Tween.get(this.plane).to({x:Math.floor(window.innerWidth/2+50),alpha:0},2e3,createjs.Ease.cubicIn).call(function(){createjs.Tween.removeTweens(c.view),c.view.removeAllChildren(),bean.fire(c,n.NEXT_SLIDE)}),createjs.Tween.get(this.circleE).wait(1050).to({x:Math.floor(window.innerWidth/2+191),y:Math.floor(window.innerHeight/2+120),alpha:0},500,createjs.Ease.cubicIn),createjs.Tween.get(this.airport).wait(450).to({scaleX:0,scaleY:0},600,createjs.Ease.elasticIn),createjs.Tween.get(this.label).wait(200).to({rotation:20,alpha:0},250,createjs.Ease.cubicIn)},a}(),n=function(){function a(){c=this,a.NEXT_SLIDE="NEXT_SLIDE",this.currentSlide=1,this.line=new createjs.Shape,this.view=new createjs.Container,this.menuNewyork=new createjs.Text("reis naar new york","14px orator_stdregular","#fff"),this.menuNewyork.addEventListener("click",c.changeSlideHandler),this.menuNewyork.x=window.innerWidth/2-400-this.menuNewyork.getBounds().width/2,this.menuNewyork.y=window.innerHeight-90,this.view.addChild(this.menuNewyork),this.menuWenen=new createjs.Text("reis naar wenen","14px orator_stdregular","#fff"),this.menuWenen.addEventListener("click",c.changeSlideHandler),this.menuWenen.x=window.innerWidth/2-this.menuWenen.getBounds().width/2,this.menuWenen.y=window.innerHeight-90,this.view.addChild(this.menuWenen),this.menuAthene=new createjs.Text("reis naar athene","14px orator_stdregular","#fff"),this.menuAthene.addEventListener("click",c.changeSlideHandler),this.menuAthene.x=window.innerWidth/2+400-this.menuAthene.getBounds().width/2,this.menuAthene.y=window.innerHeight-90,this.view.addChild(this.menuAthene),this.menuNewyork.cursor=this.menuWenen.cursor=this.menuAthene.cursor="pointer",this.currentSlideView=null,this.nextSlideHandler()
}function b(a){c.line&&c.line.graphics.clear(),c.line.graphics.beginFill("#fff"),c.line.graphics.drawRect(a.x,a.y+20,a.getBounds().width,1),c.line.graphics.endFill(),c.view.addChild(c.line)}var c;return a.prototype.changeSlideHandler=function(a){switch(a.currentTarget.text){case"reis naar new york":c.currentSlide=1;break;case"reis naar wenen":c.currentSlide=2;break;case"reis naar athene":c.currentSlide=3}},a.prototype.nextSlideHandler=function(){switch(null!=c.currentSlideView&&(bean.off(c.currentSlideView,a.NEXT_SLIDE,c.nextSlideHandler),c.view.removeChild(c.currentSlideView.view),c.currentSlideView=null),c.currentSlide){case 1:c.currentSlideView=new l,b(c.menuNewyork),c.currentSlide++;break;case 2:c.currentSlideView=new m,b(c.menuWenen),c.currentSlide++;break;case 3:c.currentSlideView=new k,b(c.menuAthene),c.currentSlide=1}c.view.addChild(c.currentSlideView.view),c.currentSlideView.animateIn(),bean.on(c.currentSlideView,a.NEXT_SLIDE,c.nextSlideHandler)},a}(),o=function(){function a(){b=this,this.view=new createjs.Container,this.dots=[],this.view.y=y.canvas.height-60,this.lines=new createjs.Graphics;var a=new createjs.Shape(this.lines);this.view.addChild(a),this.travelInfo=new q,this.view.addChild(this.travelInfo.view),this.luggageIcon=new createjs.Bitmap(z.getResult("luggage_icon")),this.view.addChild(this.luggageIcon),this.luggageIcon.x=y.canvas.width-84,this.luggageIcon.y=-15,this.luggageIcon.alpha=0,bean.on(x,u.NOW_AND_NEXT_LOADED,function(){b.lines.clear(),b.lines.setStrokeStyle(.3),b.lines.beginStroke(createjs.Graphics.getRGB(180,180,180));for(var a=b.dots.length;a<x.userModel.songs.length-2;a++){var c=new p(a);c.view.x=y.canvas.width-(100+25*a),c.view.y=0,b.view.addChild(c.view),console.log(y.canvas.width-(50+25*a)),b.dots.push(c)}b.dots.length>0&&(b.lines.moveTo(b.dots[0].view.x+30,b.dots[0].view.y),b.lines.lineTo(b.dots[b.dots.length-1].view.x,b.dots[b.dots.length-1].view.y),createjs.Tween.get(b.travelInfo.view).to({y:-70},800,createjs.Tween.cubicInOut),createjs.Tween.get(b.luggageIcon).to({alpha:1,y:-6},400,createjs.Tween.cubicInOut))})}var b;return a}(),p=function(){function a(b){a.CLICKED="CLICKED",this.songIndex=b,this.view=new createjs.Container,this.circle=new createjs.Shape,this.circle.mouseEnabled=!0,this.circle.graphics.beginFill("#000000").drawCircle(0,0,2),this.countryTxt=new createjs.Text(x.userModel.songs[b].location,"10px Arial","#000000"),this.view.addChild(this.circle),this.view.mouseEnabled=!0,this.circle.addEventListener("click",$.proxy(function(){x.setCurrentSongIndex(this.songIndex)},this))}return a}(),q=function(){function a(){b=this,this.view=new createjs.Container,this.cloud=new createjs.Bitmap(z.getResult("cloud")),this.cloud.regX=243,this.cloud.regY=124.5,this.cloud.x=-130,this.view.addChild(this.cloud),this.travelInfoContainer=new createjs.Container,this.view.addChild(this.travelInfoContainer),this.background=new createjs.Shape,this.background.graphics.beginFill("#ffd600"),this.background.graphics.drawRect(0,0,0,20),this.background.graphics.endFill(),this.travelInfoContainer.addChild(this.background),this.nextDestinationTxt=new createjs.Text("","12px orator_stdregular","#000000"),this.travelInfoContainer.addChild(this.nextDestinationTxt),this.nextDestinationTxt.x=7,this.nextDestinationTxt.y=0,this.nextDestinationTxt.textAlign="right",this.nextTitleTxt=new createjs.Text("","12px orator_stdregular","#000000"),this.nextTitleTxt.y=22,this.nextTitleTxt.x=4,this.travelInfoContainer.addChild(this.nextTitleTxt),this.nextTitleTxt.textAlign="right",this.background.y=this.nextTitleTxt.y,this.currentProgramma=new f,this.view.addChild(this.currentProgramma.view),this.view.y=-40,this.view.x=y.canvas.width-80,bean.on(x,u.NOW_AND_NEXT_LOADED,function(){if(null!=x.nextSong){createjs.Tween.get(b.travelInfoContainer).to({y:0,alpha:1}),createjs.Tween.get(b.currentProgramma.view).to({y:0,alpha:0}),b.nextDestinationTxt.text="volgende bestemming: "+x.nextSong.location;var a=x.nextSong.title+", "+x.nextSong.artist;a.length>34&&(a=a.substr(0,40),a+="..."),b.nextTitleTxt.text=a,b.background.graphics.clear(),b.background.graphics.beginFill("#ffd600"),b.background.graphics.drawRect(-b.nextTitleTxt.getMeasuredWidth(),0,b.nextTitleTxt.getMeasuredWidth()+8,18),b.background.graphics.endFill()}else createjs.Tween.get(b.travelInfoContainer).to({y:20,alpha:0}),createjs.Tween.get(b.currentProgramma.view).to({y:20,alpha:1})})}var b;return a}(),r=function(){};r.player=document.getElementById("player"),r.isPlaying=!0,r.togglePlay=function(){r.player.paused?r.player.play():r.player.stop()},r.stop=function(){r.player.stop()};var s=function(){function a(){d=this,a.LOADING_DONE="LOADING_DONE",this.isPreloadingApp=!1,this.view=new createjs.Container,z=new createjs.LoadQueue,z.installPlugin(createjs.Sound),z.addEventListener("progress",d.handleProgress),z.addEventListener("complete",d.handleComplete),z.addEventListener("fileload",d.handleFileLoad),this.preloaderView=new createjs.Container,this.progressTxt=new createjs.Text("","12 Arial","#000000"),this.preloaderView.addChild(this.progressTxt),this.progressTxt.x=y.canvas.width/2,this.progressTxt.y=y.canvas.height/2,this.removePreloaderTimeout=null}function b(){y.addChild(d.preloaderView)}function c(){y.removeChild(d.preloaderView)}var d;return a.prototype.preloadApp=function(){b(),d.isPreloadingApp=!0;var a=[{src:"assets/cloud.png",id:"cloud"},{src:"assets/klara_logo.png",id:"klara_logo"},{src:"assets/logo_background.png",id:"logo_background"},{src:"assets/worldmap3.png",id:"worldmap"},{src:"assets/buttons/facebook.png",id:"twitter"},{src:"assets/buttons/twitter.png",id:"facebook"},{src:"assets/buttons/play_pause.png"},{src:"assets/compass-indicator.png",id:"compass-indicator"},{src:"assets/compass-outer.png",id:"compass-outer"},{src:"assets/compass-inner.png",id:"compass-inner"},{src:"assets/title_app.png",id:"app_title"},{src:"assets/luggage_icon.png",id:"luggage_icon"},{src:"assets/slideshow/plane.png",id:"plane"},{src:"assets/slideshow/airport.png",id:"airport"},{src:"assets/slideshow/athene_image.png",id:"athene_image"},{src:"assets/slideshow/athene_label.png",id:"athene_label"},{src:"assets/slideshow/athene_map.png",id:"athene_map"},{src:"assets/slideshow/logo.png",id:"logo"},{src:"assets/slideshow/newyork_image.png",id:"newyork_image"},{src:"assets/slideshow/newyork_label.png",id:"newyork_label"},{src:"assets/slideshow/newyork_map.png",id:"newyork_map"},{src:"assets/slideshow/tip.png",id:"tip"},{src:"assets/slideshow/wenen_image.png",id:"wenen_image"},{src:"assets/slideshow/wenen_label.png",id:"wenen_label"},{src:"assets/slideshow/wenen_map.png",id:"wenen_map"}];z.loadManifest(a,!0)},a.prototype.handleProgress=function(a){console.log(a.loaded),d.progressTxt.text=a.loaded+"%"},a.prototype.handleFileLoad=function(a){console.log(a)},a.prototype.handleComplete=function(){c(),bean.fire(d,a.LOADING_DONE)},a.prototype.handleError=function(a){console.log("[StartScreen] error preload!"+a)},a}(),t=function(){};t.CAMPAIGN_INFO="CAMPAIGN_INFO",t.currentScreen=null,t.showScreen=function(a){t.removeCurrentScreen(),a===t.CAMPAIGN_INFO&&(console.log("[ScreenManager] "),t.currentScreen=new e),y.addChild(t.currentScreen.view)},t.removeCurrentScreen=function(){null!=t.currentScreen&&(t.currentScreen.willBeRemoved(),y.removeChild(t.currentScreen.view),t.currentScreen=null)};var u=function(){function a(){b=this,a.CURRENT_SONG_CHANGED="CURRENT_SONG_CHANGED",a.NOW_AND_NEXT_LOADED="NOW_AND_NEXT_LOADED",a.PLAYER_STATUS_CHANGED="PLAYER_STATUS_CHANGED",a.NEXT_SONG_CHANGED="NEXT_SONG_CHANGED",a.CURRENT_PROGRAMMA_CHANGED="CURRENT_PROGRAMMA_CHANGED",a.FLIGHT_ANGLE_CHANGED="FLIGHT_ANGLE_CHANGED",this.currentSongIndex=null,this.userModel=new w,this.isPlaying=!0,this.currentSong=null,this.nextSong=null,this.loadingCount=0,this.loadingProgress=0,this.currentProgramma=null,this.flightAngle=0}var b;return a.prototype.fetchProgramma=function(){$.getJSON(A.api+"/programma").done(this.fetchProgrammasHandler)},a.prototype.fetchProgrammasHandler=function(c){c.onairs[0].hasOwnProperty("now")&&(console.log("[AppModel] programma now changed"),c.onairs[0].now.onAir&&(b.currentProgramma=c.onairs[0].now,bean.fire(b,a.CURRENT_PROGRAMMA_CHANGED),console.log(b.currentProgramma)))},a.prototype.fetchPlaylist=function(){$.getJSON(A.api+"/playlist").done(this.getPlaylistHandler)},a.prototype.getPlaylistHandler=function(a){b.playlist=a.list,console.log(a)},a.prototype.fetchNowAndNext=function(){$.getJSON(A.api+"/nummer").done(b.fetchNowAndNextHandler)},a.prototype.fetchNowAndNextHandler=function(c){var d=null,e=null;b.infoNowAndNextProgress=0,b.loadingCount=0,b.loadingProgress=0;for(var f=null,g=0;g<c.onairs.length;g++){f=new v,f.title=c.onairs[g].properties[1].value,f.artist=c.onairs[g].properties[0].value;var h=new Date(c.onairs[g].startDate),i=new Date(c.onairs[g].endDate);f.duration=(i.getTime()-h.getTime())/1e3,"NOW"===c.onairs[g].onairType&&"SONG"===c.onairs[g].type?d=f:"NEXT"===c.onairs[g].onairType&&"SONG"===c.onairs[g].type&&(e=f)}if(console.log("[AppModel]",d,e),null!=d&&null==e&&null==b.currentSong)console.log("[AppModel] nieuw now"),b.currentSong=d,b.userModel.songs.push(d),b.fetchInfoForSongWithIndex(b.userModel.songs.length-1,!0);else if(null==b.currentSong&&null==b.nextSong&&null!=d&&null!=e)console.log("[AppModel] nieuw now & next"),b.currentSong=d,b.userModel.songs.push(d),b.fetchInfoForSongWithIndex(b.userModel.songs.length-1,!0),b.nextSong=e,b.userModel.songs.push(e),b.fetchInfoForSongWithIndex(b.userModel.songs.length-1,!1);else if(null!=b.nextSong&&b.nextSong.title===d.title){console.log("[AppModel] next wordt now");var j=b.userModel.songs.length-1;null!=e?(b.nextSong=e,b.userModel.songs.push(e),b.fetchInfoForSongWithIndex(b.userModel.songs.length-1,!1)):(b.nextSong=null,bean.fire(b,a.NOW_AND_NEXT_LOADED)),b.setCurrentSongIndex(j)}else null!=d&&b.currentSong.title!==d.title?console.log("[AppModel] huidig nummer is gewijzigd"):null==b.nextSong&&null!=e?(console.log("[AppModel] nextSong komt erbij "),b.nextSong=e,b.userModel.songs.push(e),b.fetchInfoForSongWithIndex(b.userModel.songs.length-1,!1)):console.log("[AppModel] huidig nummer is ongewijzigd")},a.prototype.fetchInfoForSongWithIndex=function(a,c){b.loadingCount++,console.log("[AppModel] fetchInfoForSongWithIndex: "+b.loadingCount);var d=null;d=b.userModel.songs[a].artist,d.indexOf("  ")>0&&(d=d.substring(0,d.indexOf("  "))),d.indexOf(";")>0&&(d=d.substring(0,d.indexOf(";"))),$.getJSON(A.api+"/info?artist="+d,function(){return function(d){var e=null;if(d["artist-list"].hasOwnProperty("artist"))if(e=Array.isArray(d["artist-list"].artist)?d["artist-list"].artist[0]:d["artist-list"].artist,e.hasOwnProperty("life-span")&&e["life-span"].hasOwnProperty("begin")&&(b.userModel.songs[a].period=e["life-span"].begin.substring(0,4)),e.hasOwnProperty("area"))b.userModel.songs[a].location=e.area.name;else for(var f=0;f<d["artist-list"].artist.length;f++)if(d["artist-list"].artist[f].hasOwnProperty("area")){b.userModel.songs[a].location=d["artist-list"].artist[f].area.name;break}b.fetchLngAndLatForSongWithIndex(a,c)}}())},a.prototype.fetchLngAndLatForSongWithIndex=function(c,d){console.log(x.userModel.songs[c].location),$.getJSON("http://maps.googleapis.com/maps/api/geocode/json?address="+x.userModel.songs[c].location+"&sensor=true",function(e){x.userModel.songs[c].lat=e.results[0].geometry.location.lat,x.userModel.songs[c].lng=e.results[0].geometry.location.lng,d&&(console.log("[AppModel] setCurrentIndex: "+c),b.currentSongIndex=c),b.loadingProgress++,b.loadingProgress>=b.loadingCount&&(b.currentSong=x.userModel.songs[b.currentSongIndex],x.userModel.songs.length>=b.currentSongIndex+2&&(b.nextSong=x.userModel.songs[b.currentSongIndex+1]),console.log("[AppModel] loading done!!!!!!!!"),bean.fire(b,a.NOW_AND_NEXT_LOADED))})},a.prototype.setCurrentSongIndex=function(c){c!==b.currentSongIndex&&(b.currentSongIndex=c,b.currentSong=b.userModel.songs[b.currentSongIndex],bean.fire(b,a.CURRENT_SONG_CHANGED))},a.prototype.addNextSong=function(c){c!==this.nextSong&&(this.nextSong=c,bean.fire(b,a.NEXT_SONG_CHANGED),b.getInfoForSongWithIndex(-1,!0))},a.prototype.setIsPlaying=function(b){b!==this.isPlaying&&(this.isPlaying=b,bean.fire(this,a.PLAYER_STATUS_CHANGED))},a.prototype.setFlightAngle=function(b){this.flightAngle!==b&&(this.flightAngle=b,bean.fire(this,a.FLIGHT_ANGLE_CHANGED))},a}(),v=function(){function a(){this.title="",this.artist="",this.lng=0,this.lat=0,this.location="",this.duration=0,this.period=2014}return a}(),w=function(){function a(){a.COOKIE_NAME="KLARA_REIS",a.PROGRESS_CHANGED="PROGRESS_CHANGED",a.LISTENING_TARGET=14400,this.progress=0,this.songs=[]}function b(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}document.cookie=a+"="+b+d+"; path=/"}return a.prototype.save=function(){b(a.COOKIE_NAME,JSON.stringify(this),365)},a.prototype.setProgress=function(b){this.progress=b,bean.fire(this,a.PROGRESS_CHANGED),this.save()},a}();window.fbAsyncInit=function(){FB.init({appId:"602111939860965",status:!0,cookie:!0,xfbml:!0})},function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(b,d))}(document);{var x,y,z,A=function(){function a(){}return a.api="http://localhost:8888/devine/MAV/klara/api",a.appKey="Fmjtd%7Cluur29u8n9%2C20%3Do5-908x9u",a}(),B=3e4,C=function(){function a(){_.bindAll(this);var a=document.getElementById("cnvs");a.width=window.innerWidth,a.height=window.innerHeight,y=new createjs.Stage(document.getElementById("cnvs")),y.enableMouseOver(),y.mouseMoveOutside=!0,createjs.Ticker.addEventListener("tick",b),createjs.Ticker.setFPS(60),createjs.Ticker.useRAF=!0,this.preloader=new s,bean.on(this.preloader,s.LOADING_DONE,this.preloadingDoneHandler),this.preloader.preloadApp()}function b(){y.update()}return a.prototype.preloadingDoneHandler=function(){x=new u,x.fetchNowAndNext(),setInterval(x.fetchNowAndNext,B),this.map=new i,y.addChild(this.map.view),this.timeline=new o,y.addChild(this.timeline.view),this.progress=new j(70,70),y.addChild(this.progress.view),x.fetchProgramma()},a}();new C($("#container"))}}({},function(){return this}());